import pandas as pd
import re
import os

def processar_arquivo(novo_nome_arquivo):
    # Carregar o arquivo
    arquivo_excel = fr'C:\Users\ryane\Desktop\Projetos Python Automação\Projeto1\{novo_nome_arquivo}'
    df = pd.read_excel(arquivo_excel)

    # Remover as linhas de índice 0 a 7 (descomente se necessário)
    # df = df.drop(index=range(0, 7))

    display(df[0:10])

    # Para encontrar os dados específicos
    cnpj = df.loc[8, "Unnamed: 41"]
    nome = df.loc[2, "Unnamed: 0"] 

    # Removendo "Segurado:" e colocando os 11 primeiros caracteres 
    limpando = nome.replace("Segurado:", " ")

    resultado = ''.join(filter(str.isalnum, limpando[:11]))
    cnpj_numeros = re.sub(r'\D', '', cnpj)

    print(resultado)
    print(cnpj_numeros)

    # Criar o novo nome de arquivo
    novo_nome = f'{resultado}{cnpj_numeros}(SL).xlsx'
    print(f'Novo nome do arquivo: {novo_nome}')

    # Caminho do novo arquivo
    novo_caminho = fr'C:\Users\ryane\Desktop\Projetos Python Automação\Projeto1\{novo_nome}'

    # Renomear o arquivo original
    os.rename(arquivo_excel, novo_caminho)
    print(f'Arquivo renomeado para: {novo_caminho}')

# Caminho do diretório com arquivos .xlsx
diretorio = r'C:\Users\ryane\Desktop\Projetos Python Automação\Projeto1'

# Iterar sobre todos os arquivos no diretório
for arquivo in os.listdir(diretorio):
    if arquivo.endswith('.xlsx'):
        processar_arquivo(arquivo)
